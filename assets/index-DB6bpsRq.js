import{r as u,j as e,b as j,e as O,f as R,h as D,i as E,k as w,s as y,l as V,m as M,n as W,o as G,p as P,q as Q,t as q}from"./index-B5JsWJmu.js";import"./Pagination-BaVPiqua.js";const z="_catalog_1catt_1",H="_catalogTop_1catt_7",J="_search_1catt_11",K="_filterButton_1catt_38",U="_catalogCenter_1catt_66",X="_catalogBottom_1catt_76",Y="_paginationWrapper_1catt_81",Z="_pagination_1catt_81",tt="_paginationActive_1catt_91",et="_paginationNotActive_1catt_92",st="_rightBlock_1catt_104",it="_filtersTitle_1catt_121",ct="_catalogList_1catt_137",nt="_list_1catt_143",at="_cardWrapper_1catt_148",rt="_card_1catt_148",lt="_cardDescription_1catt_171",ot="_descriptionBlock_1catt_177",dt="_subtitle_1catt_182",_t="_genresList_1catt_186",ut="_type_1catt_199",pt="_title_1catt_210",ft="_description_1catt_177",gt="_cardSceleton_1catt_217",mt="_wave_1catt_1",vt="_cardImg_1catt_224",ht="_blur_1catt_245",xt="_emptyData_1catt_275",_={catalog:z,catalogTop:H,search:J,filterButton:K,catalogCenter:U,catalogBottom:X,paginationWrapper:Y,pagination:Z,paginationActive:tt,paginationNotActive:et,rightBlock:st,filtersTitle:it,catalogList:ct,list:nt,cardWrapper:at,card:rt,cardDescription:lt,descriptionBlock:ot,subtitle:dt,genresList:_t,type:ut,title:pt,description:ft,cardSceleton:gt,wave:mt,cardImg:vt,blur:ht,emptyData:xt},jt="_filters_28rda_1",Ct="_filter_28rda_1",Nt="_titleBlock_28rda_18",kt="_title_28rda_18",It="_description_28rda_35",bt="_activeMobile_28rda_40",At="_filterActive_28rda_46",St="_filterList_28rda_82",Tt="_filterItem_28rda_123",Lt="_filterItemActive_28rda_124",$t="_active_28rda_40",wt="_clickAnimation_28rda_150",yt="_click_28rda_150",r={filters:jt,filter:Ct,titleBlock:Nt,title:kt,description:It,activeMobile:bt,filterActive:At,filterList:St,filterItem:Tt,filterItemActive:Lt,active:$t,clickAnimation:wt,click:yt};function Bt({onClickItem:t,item:s}){const[i,o]=u.useState(!1),n=d=>{t(d),o(!i)};return e.jsxs("li",{onClick:()=>n(s),className:i?r.filterItemActive:r.filterItem,children:[s.name,s.label]},s.id)}function Ft({type:t,onClickGenre:s,data:i,placeholder:o}){const n=j(p=>p.catalog.genres),[d,l]=u.useState(!1),[a,c]=u.useState(!1),g=()=>{l(!d),c(!0),setTimeout(()=>{c(!1)},200)};return e.jsxs("div",{className:r.filter,children:[e.jsxs("div",{className:r.titleBlock,children:[e.jsx("div",{className:r.title,children:t}),e.jsx("p",{className:r.description,children:"Укажите жанры, по которым будут отфильтрованы все наши релизы. При выборе нескольких — будет использована комбинация"})]}),e.jsxs("div",{className:r.filterContent,children:[e.jsx("div",{onClick:g,className:a?`${r.filterActive} ${r.clickAnimation}`:r.filterActive,children:n.length>=1?n.map((p,m)=>m===0||m===-1?p.name:", "+p.name):o}),e.jsx("ul",{className:d?`${r.filterList} ${r.active}`:r.filterList,children:i==null?void 0:i.map(p=>e.jsx(Bt,{onClickItem:s,item:p},p.id))})]})]})}function Ot({onClickItem:t,item:s,sortText:i}){const[o,n]=u.useState(!1),d=(l,a)=>{t(l,a),n(!o)};return e.jsxs("li",{onClick:()=>d(s.value,s.label),className:i===s.label?r.filterItemActive:r.filterItem,children:[s.name,s.label]},s.id)}function Rt({type:t,onClickSort:s,data:i}){const o=j(g=>g.catalog.sortText),[n,d]=u.useState(!1),[l,a]=u.useState(!1),c=()=>{d(!n),a(!0),setTimeout(()=>{a(!1)},200)};return e.jsxs("div",{className:r.filter,children:[e.jsxs("div",{className:r.titleBlock,children:[e.jsx("div",{className:r.title,children:t}),e.jsx("p",{className:r.description,children:"Укажите способ сортировки для отображения всех тайтлов в каталоге"})]}),e.jsxs("div",{className:r.filterContent,children:[e.jsx("div",{onClick:c,className:l?`${r.filterActive} ${r.clickAnimation}`:r.filterActive,children:o}),e.jsx("ul",{className:n?`${r.filterList} ${r.active}`:r.filterList,children:i&&i.map(g=>e.jsx(Ot,{sortText:o,item:g,onClickItem:s},g.value))})]})]})}function Dt({genresData:t,sortData:s,onClickGenre:i,onClickSort:o,isOpenMobileFilter:n}){return e.jsxs("div",{className:n?`${r.filters} ${r.activeMobile}`:r.filters,children:[e.jsx(Ft,{type:"Жанры",placeholder:"Укажите жанры",data:t,onClickGenre:i}),e.jsx(Rt,{type:"Сортировка",placeholder:"Укажите способ сортировки",data:s,onClickSort:o})]})}const Et="_sceletonTitleList_ahx2d_1",Vt="_card_ahx2d_18",Mt="_img_ahx2d_25",Wt="_wave_ahx2d_1",Gt="_description_ahx2d_31",A={sceletonTitleList:Et,card:Vt,img:Mt,wave:Wt,description:Gt};function Pt({count:t=10}){return e.jsx("div",{className:A.sceletonTitleList,children:[...Array(t)].map((s,i)=>e.jsxs("div",{className:A.card,children:[e.jsx("div",{className:A.img}),e.jsx("div",{className:A.description})]},i))})}var L=new Map,S=new WeakMap,$=0,Qt=void 0;function qt(t){return t?(S.has(t)||($+=1,S.set(t,$.toString())),S.get(t)):"0"}function zt(t){return Object.keys(t).sort().filter(s=>t[s]!==void 0).map(s=>`${s}_${s==="root"?qt(t.root):t[s]}`).toString()}function Ht(t){const s=zt(t);let i=L.get(s);if(!i){const o=new Map;let n;const d=new IntersectionObserver(l=>{l.forEach(a=>{var c;const g=a.isIntersecting&&n.some(p=>a.intersectionRatio>=p);t.trackVisibility&&typeof a.isVisible>"u"&&(a.isVisible=g),(c=o.get(a.target))==null||c.forEach(p=>{p(g,a)})})},t);n=d.thresholds||(Array.isArray(t.threshold)?t.threshold:[t.threshold||0]),i={id:s,observer:d,elements:o},L.set(s,i)}return i}function Jt(t,s,i={},o=Qt){if(typeof window.IntersectionObserver>"u"&&o!==void 0){const c=t.getBoundingClientRect();return s(o,{isIntersecting:o,target:t,intersectionRatio:typeof i.threshold=="number"?i.threshold:0,time:0,boundingClientRect:c,intersectionRect:c,rootBounds:c}),()=>{}}const{id:n,observer:d,elements:l}=Ht(i),a=l.get(t)||[];return l.has(t)||l.set(t,a),a.push(s),d.observe(t),function(){a.splice(a.indexOf(s),1),a.length===0&&(l.delete(t),d.unobserve(t)),l.size===0&&(d.disconnect(),L.delete(n))}}function B({threshold:t,delay:s,trackVisibility:i,rootMargin:o,root:n,triggerOnce:d,skip:l,initialInView:a,fallbackInView:c,onChange:g}={}){var p;const[m,T]=u.useState(null),C=u.useRef(),[N,h]=u.useState({inView:!!a,entry:void 0});C.current=g,u.useEffect(()=>{if(l||!m)return;let x;return x=Jt(m,(b,f)=>{h({inView:b,entry:f}),C.current&&C.current(b,f),f.isIntersecting&&d&&x&&(x(),x=void 0)},{root:n,rootMargin:o,threshold:t,trackVisibility:i,delay:s},c),()=>{x&&x()}},[Array.isArray(t)?t.toString():t,m,n,o,d,l,i,c,s]);const k=(p=N.entry)==null?void 0:p.target,I=u.useRef();!m&&k&&!d&&!l&&I.current!==k&&(I.current=k,h({inView:!!a,entry:void 0}));const v=[T,N.inView,N.entry];return v.ref=v[0],v.inView=v[1],v.entry=v[2],v}function Kt({e:t,isLoading:s,dataFavorites:i}){var c,g,p;const{onClickAddFavorite:o,onClickDeleteFavorite:n}=O(),d=R(),{ref:l,inView:a}=B({threshold:.5,triggerOnce:!0});return e.jsxs("div",{className:_.cardWrapper,children:[e.jsxs("div",{ref:l,className:_.card,onClick:()=>d(`/title/${t.id}`),children:[s?e.jsx("div",{className:_.cardSceleton}):e.jsx("div",{className:a&&!s?_.cardImg:`${_.cardImg} ${_.blur}`,children:e.jsx("img",{onClick:()=>d(`/title/${t.id}`),className:_.cardImg,src:(c=t.poster)!=null&&c.src?`https://anilibria.top${(g=t.poster)==null?void 0:g.src}`:`https://anilibria.top${(p=t.posters)==null?void 0:p.small.url}`,alt:""},t.id)}),e.jsxs("div",{className:_.cardDescription,children:[e.jsx("h5",{className:_.title,children:t.name.main}),e.jsxs("div",{className:_.descriptionBlock,children:[e.jsx("p",{className:_.subtitle,children:t.name.english}),e.jsx("div",{className:_.genresList,children:t.genres.map(m=>e.jsx("li",{className:_.genres,children:m.name},m.id))}),e.jsxs("ul",{className:_.type,children:[e.jsx("li",{children:t.year}),e.jsx("li",{children:t.season.description}),e.jsx("li",{children:t.type.description}),e.jsx("li",{children:t.age_rating.label})]})]}),e.jsx("p",{className:_.description,children:t.description})]})]}),!s&&((i==null?void 0:i.filter(m=>m.id===t.id).length)===1?e.jsx("button",{onClick:()=>n(t.id,t),children:e.jsx("img",{src:D,alt:""})}):e.jsx("button",{onClick:()=>o(t.id,t),children:e.jsx("img",{src:E,alt:""})}))]})}function Ut({data:t,isLoading:s,isFetching:i,isSuccess:o,dataFavorites:n,setPage:d}){const{ref:l,inView:a}=B({threshold:.5});return u.useEffect(()=>{a&&d(c=>c+1)},[a]),e.jsxs("div",{className:_.catalogList,children:[s?e.jsx(Pt,{count:10}):e.jsx("div",{className:_.list,children:t.length>0?t.map(c=>e.jsx(Kt,{e:c,isLoading:s,dataFavorites:n},c.id)):e.jsxs("div",{className:_.emptyData,children:["Ничего не найдено",e.jsx("span",{children:"По вашим параметрам не найдено ни одного релиза"})]})}),(t==null?void 0:t.length)!==0&&e.jsx("div",{ref:l})]})}const Xt=t=>u.createElement("svg",{width:"800px",height:"800px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},u.createElement("path",{d:"M21 21L3 3V6.33726C3 6.58185 3 6.70414 3.02763 6.81923C3.05213 6.92127 3.09253 7.01881 3.14736 7.10828C3.2092 7.2092 3.29568 7.29568 3.46863 7.46863L9.53137 13.5314C9.70432 13.7043 9.7908 13.7908 9.85264 13.8917C9.90747 13.9812 9.94787 14.0787 9.97237 14.1808C10 14.2959 10 14.4182 10 14.6627V21L14 17V14M8.60139 3H19.4C19.9601 3 20.2401 3 20.454 3.10899C20.6422 3.20487 20.7951 3.35785 20.891 3.54601C21 3.75992 21 4.03995 21 4.6V6.33726C21 6.58185 21 6.70414 20.9724 6.81923C20.9479 6.92127 20.9075 7.01881 20.8526 7.10828C20.7908 7.2092 20.7043 7.29568 20.5314 7.46863L16.8008 11.1992",stroke:"#000000",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"}));function Yt({setPage:t}){const[s,i]=u.useState(""),o=w();return u.useEffect(()=>{const n=setTimeout(()=>{t(1),o(y(s))},700);return()=>{t(1),clearTimeout(n)}},[s]),e.jsx("div",{className:_.search,children:e.jsx("input",{type:"text",placeholder:"Поиск...",value:s,onChange:n=>i(n.target.value)})})}function ee(){const[t,s]=u.useState(10),{searchText:i,inputText:o}=j(f=>f.search),{sortValue:n}=j(f=>f.catalog),[d,l]=u.useState(1),a=j(f=>f.catalog.genres),{data:c,isFetching:g,isSuccess:p,isLoading:m}=V({page:d,sortValue:n,genres:a.map(f=>f.id),searchText:i,limit:t}),T=j(f=>f.favorites.favorites),C=M(),N=W(),h=w();c==null||c.meta.pagination.total_pages;const k=u.useRef();G(()=>setIsOpenSort(!1),k);const[I,v]=u.useState(!0);u.useEffect(()=>()=>{h(P()),h(y(""))},[]);const x=(f,F)=>{window.scrollTo(0,0),h(Q({text:F,value:f})),l(1)};u.useCallback(f=>{h(l(f))},[]);const b=f=>{window.scrollTo(0,0),h(q(f)),l(1)};return e.jsx(e.Fragment,{children:e.jsxs("main",{className:`${_.catalog} container`,children:[e.jsxs("div",{className:_.catalogTop,children:[e.jsx(Yt,{setPage:l}),e.jsx("div",{className:_.filterButton,onClick:()=>v(!I),children:e.jsx(Xt,{})})]}),e.jsxs("div",{className:_.catalogCenter,children:[e.jsx(Ut,{setPage:l,data:c==null?void 0:c.data,isLoading:m,isFetching:g,isSuccess:p,dataFavorites:T}),I&&e.jsx("div",{className:_.rightBlock,children:e.jsx(Dt,{genresData:N.data,sortData:C.data,onClickGenre:b,onClickSort:x})})]}),e.jsx("div",{className:_.catalogBottom})]})})}export{ee as default};
