import{l as F,m as q,r as l,a as g,j as c,c as m,i as x,L as y,T as f,B as A}from"./index-B_PAhCEP.js";import{u as z}from"./useDynamicReducers-DuyOJXqr.js";import{G as v}from"./GridList-CAVnLb-l.js";const E="_catalogPage_zr7sf_1",R="_filter_zr7sf_13",O="_input_zr7sf_18",Q="_catalogList_zr7sf_25",B="_button_zr7sf_31",j={catalogPage:E,filter:R,input:O,catalogList:Q,button:B},G=F({name:"search",initialState:{search:"",years:[],type:[],season_code:"",genres:[],voice:"",translator:"",editing:"",decor:"",timing:"",filter:"",remove:"",limit:"",order_by:"",sort_direction:0,page:1,items_per_page:20,isLoadingData:!1},reducers:{setIsLoadingData:(e,s)=>{e.isLoadingData=s.payload},setSearchText:(e,s)=>{e.search=s.payload,e.page=1},setPage:(e,s)=>{e.page=s.payload},incrementPage:e=>{e.page=e.page+1},setGenres:(e,s)=>{e.genres.find(r=>r===s.payload)?e.genres=e.genres.filter(r=>r!==s.payload):e.genres.push(s.payload),e.page=1},setYears:(e,s)=>{e.years.find(r=>r===s.payload)?e.years=e.years.filter(r=>r!==s.payload):e.years.push(s.payload),e.page=1},setType:(e,s)=>{e.type.find(r=>r===s.payload)?e.type=e.type.filter(r=>r!==s.payload):e.type.push(s.payload),e.page=1},resetFilters:e=>{e.search="",e.years=[],e.type=[],e.season_code="",e.genres=[],e.voice="",e.translator="",e.editing="",e.decor="",e.timing="",e.filter="",e.remove="",e.limit="",e.order_by="",e.sort_direction=0,e.page=1,e.items_per_page=30},initFavoritesList:e=>{const s=JSON.parse(localStorage.getItem("favorites"));e.favoritesList=s||[]}}}),{actions:_}=G,{reducer:D}=G,V="_filter_aabyg_1",M="_title_aabyg_8",J="_isActive_aabyg_12",W="_list_aabyg_12",w="_item_aabyg_46",o={filter:V,title:M,isActive:J,list:W,item:w},N=q.injectEndpoints({endpoints:e=>({getSearch:e.query({query:({searchText:s="",page:r=1,genres:t=[],years:i=[],types:n=[],itemsPerPage:u=40})=>`title/search?${s.length>=3||t.length>0||i.length>0||n.length>0?"":"year=2025"}&${s&&`search=${s}`}&${t&&`genres=${t}`}&${i.length>0?`year=${i}`:""}&${n.length>0?`type=${n}`:""}&playlist_type=array&order_by=in_favorites&sort_direction=1&items_per_page=${u}&page=${r}`,serializeQueryArgs:({endpointName:s})=>s,merge:(s,r,{arg:t})=>{t.page!==1?s.list.push(...r.list):s.list=r.list},forceRefetch({currentArg:s,previousArg:r}){return s!==r}}),getGenres:e.query({query:()=>"genres"}),getYears:e.query({query:()=>"years"})})}),H=N.useGetSearchQuery,S=N.useGetGenresQuery,T=N.useGetYearsQuery,P=l.memo(({genre:e,onClick:s})=>{const t=g(i=>{var n;return(n=i==null?void 0:i.search)==null?void 0:n.genres}).find(i=>i===e)&&o.isActive;return c.jsx("li",{className:m(o.item,{},[t]),onClick:s,children:e})});l.memo(({cls:e})=>{const{data:s,isLoading:r}=S(),t=x(),[i,n]=l.useState(!1),u=l.useCallback(d=>{t(_.setGenres(d))},[t]);return r?c.jsx(y,{}):c.jsxs("div",{className:m(o.filter,{},[o[e]]),children:[c.jsx("h3",{onClick:()=>n(!i),className:m(o.title,{},[i&&o.isActive]),children:"Жанры"}),c.jsx("ul",{className:o.list,children:s==null?void 0:s.map(d=>c.jsx(P,{genre:d,onClick:()=>u(d)},d))})]})});const K=l.memo(()=>{const e=g(a=>{var p;return(p=a==null?void 0:a.search)==null?void 0:p.search}),s=g(a=>{var p;return(p=a==null?void 0:a.search)==null?void 0:p.page}),r=g(a=>{var p;return(p=a==null?void 0:a.search)==null?void 0:p.genres}),t=g(a=>{var p;return(p=a==null?void 0:a.search)==null?void 0:p.years}),i=g(a=>{var p;return(p=a==null?void 0:a.search)==null?void 0:p.type}),{data:n,isLoading:u,isFetching:d,originalArgs:h}=H({searchText:e,page:s||1,genres:r,years:t,types:i}),Y=x();return u?c.jsx(y,{}):n.list.length===0?c.jsx("div",{children:"Ничего не найдено"}):c.jsxs("section",{className:m(j.catalogList,{},[]),children:[c.jsx("div",{className:j.list,children:!u&&h.page!==1?c.jsx(v,{children:n==null?void 0:n.list.map(a=>c.jsx(f,{isFetching:d,item:a},a.id))}):!d&&h.page!==1?c.jsx(v,{children:n==null?void 0:n.list.map(a=>c.jsx(f,{isFetching:d,item:a},a.id))}):!d&&h.page===1?c.jsx(v,{children:n==null?void 0:n.list.map(a=>c.jsx(f,{isFetching:d,item:a},a.id))}):c.jsx(y,{})}),c.jsx("div",{className:j.button,children:d?(h==null?void 0:h.page)!==1?c.jsx(y,{}):(h==null?void 0:h.page)===1?c.jsx("div",{}):c.jsx(y,{}):c.jsx(A,{type:"text",align:"center",onClick:()=>Y(_.incrementPage()),children:"Показать еще"})})]})}),U="_search_bkknv_1",L={search:U},b={},X=l.memo(({cls:e,placeholder:s,type:r,style:t,name:i,label:n="",value:u,onChange:d})=>c.jsxs("div",{className:m(b.input,{},[b[t],[e]]),children:[c.jsx("label",{htmlFor:i,children:n}),c.jsx("input",{placeholder:s,type:r,name:i,id:i,value:u,onChange:d})]})),Z=l.memo(({cls:e})=>{const s=x(),[r,t]=l.useState("");l.useEffect(()=>{const n=setTimeout(()=>{s(_.setSearchText(r))},700);return()=>{clearTimeout(n)}},[s,r]);const i=n=>{t(n.target.value)};return c.jsx("div",{className:m(L.search,{},[e]),children:c.jsx(X,{cls:L.search,onChange:n=>i(n),value:r})})}),I=l.memo(({year:e,onClick:s})=>{const t=g(i=>{var n;return(n=i==null?void 0:i.search)==null?void 0:n.years}).find(i=>i===e)&&o.isActive;return c.jsx("li",{className:m(o.item,{},[t]),onClick:s,children:e})});l.memo(({cls:e})=>{const{data:s,isLoading:r}=T(),t=x(),i=l.useCallback(n=>{t(_.setYears(n))},[t]);return r?c.jsx(y,{}):c.jsxs("div",{className:m(o.filter,{},[o[e]]),children:[c.jsx("h3",{className:o.title,children:"Года"}),c.jsx("ul",{className:o.list,children:s==null?void 0:s.map(n=>c.jsx(I,{year:n,onClick:()=>i(n)},n))})]})});const $={},k=l.memo(({cls:e,render:s,title:r})=>{const[t,i]=l.useState(!1);return c.jsxs("div",{className:m(o.filter,{},[]),children:[c.jsx("h3",{onClick:()=>i(!t),className:m(o.title,{},[t&&o.isActive]),children:r}),c.jsx("ul",{className:m(o.list,{},[e]),children:s})]})}),ee=l.memo(()=>{const{data:e,isLoading:s}=S(),r=x(),t=l.useCallback(i=>{r(_.setGenres(i))},[r]);return s?c.jsx(y,{}):c.jsx(k,{cls:$.genres,title:"Жанры",render:e==null?void 0:e.map(i=>c.jsx(P,{className:$.genre,genre:i,onClick:()=>t(i)},i))})}),se=l.memo(()=>{const{data:e,isLoading:s}=T(),r=x(),t=l.useCallback(i=>{r(_.setYears(i))},[r]);return s?c.jsx(y,{}):c.jsx(k,{title:"Года",render:e==null?void 0:e.map(i=>c.jsx(I,{year:i,onClick:()=>t(i)},i))})}),ie="_types_6f80v_1",ce="_type_6f80v_1",re="_isActive_6f80v_24",C={types:ie,type:ce,isActive:re},ne=l.memo(()=>{const e=x(),s=g(i=>{var n;return(n=i==null?void 0:i.search)==null?void 0:n.type}),r=l.useMemo(()=>[{name:"Фильм",string:"MOVIE",id:0},{name:"ТВ",string:"TV",id:1},{name:"OVA",id:2},{name:"ONA",id:3},{name:"Спешл",id:4},{name:"WEB",id:5}],[]),t=l.useCallback(i=>{e(_.setType(i))},[e]);return c.jsx(k,{cls:C.types,title:"Тип",render:r.map(i=>c.jsx("li",{className:m(C.type,{},[(s==null?void 0:s.find(n=>n===i.name))&&C.isActive]),onClick:()=>t(i.name),children:i.name},i.id))})}),te={search:D},de=l.memo(()=>{z(te);const e=x(),s=l.useCallback(()=>{e(_.resetFilters())},[e]);return c.jsxs("section",{className:m(j.catalogPage,{},["container"]),children:[c.jsxs("div",{children:[c.jsx(Z,{cls:j.input}),c.jsx(K,{})]}),c.jsxs("div",{className:j.filter,children:[c.jsx(ee,{}),c.jsx(se,{}),c.jsx(ne,{}),c.jsx(A,{type:"text",onClick:s,children:"Сбросить фильтры"})]})]})});export{de as default};
